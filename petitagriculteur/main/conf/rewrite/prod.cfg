server {

	listen 443 ssl;
	server_name www.petitagriculteur.fr;
	root /var/www/petitagriculteur;

    ssl_certificate /etc/letsencrypt/live/www.petitagriculteur.fr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/www.petitagriculteur.fr/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	include /var/www/petitagriculteur/framework/dev/conf/rewrite/bot.cfg;
	include /var/www/petitagriculteur/framework/dev/conf/rewrite/asset.cfg;


	location @minify {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=petitagriculteur&limeName=$1? last;
	}

	location / {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=petitagriculteur&limeName=$1? last;
	}

	include /var/www/petitagriculteur/framework/dev/conf/rewrite/lime.cfg;

}

server {

	listen 443 ssl;
	server_name demo.petitagriculteur.fr;
	root /var/www/petitagriculteur;

    ssl_certificate /etc/letsencrypt/live/demo.petitagriculteur.fr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/demo.petitagriculteur.fr/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	include /var/www/petitagriculteur/framework/dev/conf/rewrite/bot.cfg;
	include /var/www/petitagriculteur/framework/dev/conf/rewrite/asset.cfg;


	location @minify {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=petitagriculteur&limeName=$1? last;
	}

	location / {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=petitagriculteur&limeName=$1? last;
	}

	include /var/www/petitagriculteur/framework/dev/conf/rewrite/lime.cfg;

}

server {

	listen 80;
	server_name petitagriculteur.fr www.petitagriculteur.fr;

	return 301 https://www.petitagriculteur.fr$request_uri;

}

server {

	listen 80;
	server_name demo.petitagriculteur.fr;

	return 301 https://demo.petitagriculteur.fr$request_uri;

}

server {

	listen 443 ssl;
	server_name petitagriculteur.fr;

    ssl_certificate /etc/letsencrypt/live/petitagriculteur.fr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/petitagriculteur.fr/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	return 301 https://www.petitagriculteur.fr$request_uri;

}

server {

	listen 443 ssl;
	server_name site.petitagriculteur.fr;
	root /var/www/petitagriculteur;

    ssl_certificate /etc/letsencrypt/live/site.petitagriculteur.fr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/site.petitagriculteur.fr/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	include /var/www/petitagriculteur/framework/dev/conf/rewrite/bot.cfg;
	include /var/www/petitagriculteur/framework/dev/conf/rewrite/asset.cfg;

	location @minify {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=petitagriculteur&limeName=$1? last;
	}

	location / {
		rewrite ^(\/[a-zA-Z0-9\_\-]+[\/]?)$ /_lime?$args&origin=internal&limeEnv=prod&limeApp=petitagriculteur&limeName=/public$1? last;
		rewrite ^(\/[a-zA-Z0-9\_\-]+\/[a-zA-Z0-9\_\-\.]+)$ /_lime?$args&origin=internal&limeEnv=prod&limeApp=petitagriculteur&limeName=/public$1? last;
		rewrite ^(\/[a-zA-Z0-9\_\-]+)\/.+$ /_lime?$args&origin=internal&limeEnv=prod&limeApp=petitagriculteur&limeName=/public$1/400? last;
        rewrite ^(.*)$ /_lime?$args&origin=internal&limeEnv=prod&limeApp=petitagriculteur&limeName=/error$1? last;
	}

	include /var/www/petitagriculteur/framework/dev/conf/rewrite/lime.cfg;

}

server {

	listen 80;
	server_name site.petitagriculteur.fr;

	return 301 https://site.petitagriculteur.fr$request_uri;

}

server {

	listen 443 ssl;
	server_name media.petitagriculteur.fr;
	root /var/www/storage;

    ssl_certificate /etc/letsencrypt/live/media.petitagriculteur.fr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/media.petitagriculteur.fr/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	error_page 404 /404.png;

	expires 30d;

}

server {

	listen 80;
	server_name media.petitagriculteur.fr;

	return 301 https://media.petitagriculteur.fr$request_uri;

}

server {

	listen 443 ssl;
	server_name boutique.petitagriculteur.fr;
	root /var/www/petitagriculteur;

	ssl_certificate /etc/letsencrypt/live/boutique.petitagriculteur.fr/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/boutique.petitagriculteur.fr/privkey.pem;
	include /etc/letsencrypt/options-ssl-nginx.conf;
	ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	include /var/www/petitagriculteur/framework/dev/conf/rewrite/bot.cfg;
	include /var/www/petitagriculteur/framework/dev/conf/rewrite/asset.cfg;

	location @minify {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=petitagriculteur&limeName=$1? last;
	}

	location / {
		rewrite ^/user/(.*)$ /_lime?$args&limeEnv=prod&limeApp=petitagriculteur&limeName=/user/$1? last;
		rewrite ^(.*)$ /_lime?$args&origin=internal&limeEnv=prod&limeApp=petitagriculteur&limeName=/shop/public$1? last;
	}

	include /var/www/petitagriculteur/framework/dev/conf/rewrite/lime.cfg;

}

server {

	listen 80;
	server_name boutique.petitagriculteur.fr shop.petitagriculteur.fr;

	return 301 https://boutique.petitagriculteur.fr$request_uri;

}

server {

	listen 443 ssl;
	server_name shop.petitagriculteur.fr;

	ssl_certificate /etc/letsencrypt/live/shop.petitagriculteur.fr/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/shop.petitagriculteur.fr/privkey.pem;
	include /etc/letsencrypt/options-ssl-nginx.conf;
	ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	return 301 https://boutique.petitagriculteur.fr$request_uri;

}
