server {

	listen 443 ssl;
	server_name www.comptetonble.fr;
	root /var/www/ctb;

    ssl_certificate /etc/letsencrypt/live/www.comptetonble.fr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/www.comptetonble.fr/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	include /var/www/ctb/framework/dev/conf/rewrite/bot.cfg;
	include /var/www/ctb/framework/dev/conf/rewrite/asset.cfg;


	location @minify {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=comptetonble&limeName=$1? last;
	}

	location / {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=comptetonble&limeName=$1? last;
	}

	include /var/www/ctb/framework/dev/conf/rewrite/lime.cfg;

}

server {

	listen 443 ssl;
	server_name demo.comptetonble.fr;
	root /var/www/ctb;

    ssl_certificate /etc/letsencrypt/live/demo.comptetonble.fr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/demo.comptetonble.fr/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	include /var/www/ctb/framework/dev/conf/rewrite/bot.cfg;
	include /var/www/ctb/framework/dev/conf/rewrite/asset.cfg;


	location @minify {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=comptetonble&limeName=$1? last;
	}

	location / {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=comptetonble&limeName=$1? last;
	}

	include /var/www/ctb/framework/dev/conf/rewrite/lime.cfg;

}

server {

	listen 80;
	server_name comptetonble.fr www.comptetonble.fr;

	return 301 https://www.comptetonble.fr$request_uri;

}

server {

	listen 80;
	server_name demo.comptetonble.fr;

	return 301 https://demo.comptetonble.fr$request_uri;

}

server {

	listen 443 ssl;
	server_name comptetonble.fr;

    ssl_certificate /etc/letsencrypt/live/comptetonble.fr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/comptetonble.fr/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	return 301 https://www.comptetonble.fr$request_uri;

}

server {

	listen 443 ssl;
	server_name site.comptetonble.fr;
	root /var/www/ctb;

    ssl_certificate /etc/letsencrypt/live/site.comptetonble.fr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/site.comptetonble.fr/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	include /var/www/ctb/framework/dev/conf/rewrite/bot.cfg;
	include /var/www/ctb/framework/dev/conf/rewrite/asset.cfg;

	location @minify {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=comptetonble&limeName=$1? last;
	}

	location / {
		rewrite ^(\/[a-zA-Z0-9\_\-]+[\/]?)$ /_lime?$args&origin=internal&limeEnv=prod&limeApp=comptetonble&limeName=/public$1? last;
		rewrite ^(\/[a-zA-Z0-9\_\-]+\/[a-zA-Z0-9\_\-\.]+)$ /_lime?$args&origin=internal&limeEnv=prod&limeApp=comptetonble&limeName=/public$1? last;
		rewrite ^(\/[a-zA-Z0-9\_\-]+)\/.+$ /_lime?$args&origin=internal&limeEnv=prod&limeApp=comptetonble&limeName=/public$1/400? last;
        rewrite ^(.*)$ /_lime?$args&origin=internal&limeEnv=prod&limeApp=comptetonble&limeName=/error$1? last;
	}

	include /var/www/ctb/framework/dev/conf/rewrite/lime.cfg;

}

server {

	listen 80;
	server_name site.comptetonble.fr;

	return 301 https://site.comptetonble.fr$request_uri;

}

server {

	listen 443 ssl;
	server_name media.comptetonble.fr;
	root /var/www/storage;

    ssl_certificate /etc/letsencrypt/live/media.comptetonble.fr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/media.comptetonble.fr/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	error_page 404 /404.png;

	expires 30d;

}

server {

	listen 80;
	server_name media.comptetonble.fr;

	return 301 https://media.comptetonble.fr$request_uri;

}

server {

	listen 443 ssl;
	server_name boutique.comptetonble.fr;
	root /var/www/ctb;

	ssl_certificate /etc/letsencrypt/live/boutique.comptetonble.fr/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/boutique.comptetonble.fr/privkey.pem;
	include /etc/letsencrypt/options-ssl-nginx.conf;
	ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	include /var/www/ctb/framework/dev/conf/rewrite/bot.cfg;
	include /var/www/ctb/framework/dev/conf/rewrite/asset.cfg;

	location @minify {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=comptetonble&limeName=$1? last;
	}

	location / {
		rewrite ^/user/(.*)$ /_lime?$args&limeEnv=prod&limeApp=comptetonble&limeName=/user/$1? last;
		rewrite ^(.*)$ /_lime?$args&origin=internal&limeEnv=prod&limeApp=comptetonble&limeName=/shop/public$1? last;
	}

	include /var/www/ctb/framework/dev/conf/rewrite/lime.cfg;

}

server {

	listen 80;
	server_name boutique.comptetonble.fr shop.comptetonble.fr;

	return 301 https://boutique.comptetonble.fr$request_uri;

}

server {

	listen 443 ssl;
	server_name shop.comptetonble.fr;

	ssl_certificate /etc/letsencrypt/live/shop.comptetonble.fr/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/shop.comptetonble.fr/privkey.pem;
	include /etc/letsencrypt/options-ssl-nginx.conf;
	ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	return 301 https://boutique.comptetonble.fr$request_uri;

}