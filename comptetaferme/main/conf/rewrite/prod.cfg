server {

	listen 443 ssl;
	server_name www.comptetaferme.fr;
	root /var/www/ctf;

    ssl_certificate /etc/letsencrypt/live/www.comptetaferme.fr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/www.comptetaferme.fr/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	include /var/www/ctf/framework/dev/conf/rewrite/bot.cfg;
	include /var/www/ctf/framework/dev/conf/rewrite/asset.cfg;


	location @minify {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=comptetaferme&limeName=$1? last;
	}

	location / {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=comptetaferme&limeName=$1? last;
	}

	include /var/www/ctf/framework/dev/conf/rewrite/lime.cfg;

}

server {

	listen 443 ssl;
	server_name demo.comptetaferme.fr;
	root /var/www/ctf;

    ssl_certificate /etc/letsencrypt/live/demo.comptetaferme.fr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/demo.comptetaferme.fr/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	include /var/www/ctf/framework/dev/conf/rewrite/bot.cfg;
	include /var/www/ctf/framework/dev/conf/rewrite/asset.cfg;


	location @minify {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=comptetaferme&limeName=$1? last;
	}

	location / {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=comptetaferme&limeName=$1? last;
	}

	include /var/www/ctf/framework/dev/conf/rewrite/lime.cfg;

}

server {

	listen 80;
	server_name comptetaferme.fr www.comptetaferme.fr;

	return 301 https://www.comptetaferme.fr$request_uri;

}

server {

	listen 80;
	server_name demo.comptetaferme.fr;

	return 301 https://demo.comptetaferme.fr$request_uri;

}

server {

	listen 443 ssl;
	server_name comptetaferme.fr;

    ssl_certificate /etc/letsencrypt/live/comptetaferme.fr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/comptetaferme.fr/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	return 301 https://www.comptetaferme.fr$request_uri;

}

server {

	listen 443 ssl;
	server_name site.comptetaferme.fr;
	root /var/www/ctf;

    ssl_certificate /etc/letsencrypt/live/site.comptetaferme.fr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/site.comptetaferme.fr/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	include /var/www/ctf/framework/dev/conf/rewrite/bot.cfg;
	include /var/www/ctf/framework/dev/conf/rewrite/asset.cfg;

	location @minify {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=comptetaferme&limeName=$1? last;
	}

	location / {
		rewrite ^(\/[a-zA-Z0-9\_\-]+[\/]?)$ /_lime?$args&origin=internal&limeEnv=prod&limeApp=comptetaferme&limeName=/public$1? last;
		rewrite ^(\/[a-zA-Z0-9\_\-]+\/[a-zA-Z0-9\_\-\.]+)$ /_lime?$args&origin=internal&limeEnv=prod&limeApp=comptetaferme&limeName=/public$1? last;
		rewrite ^(\/[a-zA-Z0-9\_\-]+)\/.+$ /_lime?$args&origin=internal&limeEnv=prod&limeApp=comptetaferme&limeName=/public$1/400? last;
        rewrite ^(.*)$ /_lime?$args&origin=internal&limeEnv=prod&limeApp=comptetaferme&limeName=/error$1? last;
	}

	include /var/www/ctf/framework/dev/conf/rewrite/lime.cfg;

}

server {

	listen 80;
	server_name site.comptetaferme.fr;

	return 301 https://site.comptetaferme.fr$request_uri;

}

server {

	listen 443 ssl;
	server_name media.comptetaferme.fr;
	root /var/www/storage;

    ssl_certificate /etc/letsencrypt/live/media.comptetaferme.fr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/media.comptetaferme.fr/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	error_page 404 /404.png;

	expires 30d;

}

server {

	listen 80;
	server_name media.comptetaferme.fr;

	return 301 https://media.comptetaferme.fr$request_uri;

}

server {

	listen 443 ssl;
	server_name boutique.comptetaferme.fr;
	root /var/www/ctf;

	ssl_certificate /etc/letsencrypt/live/boutique.comptetaferme.fr/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/boutique.comptetaferme.fr/privkey.pem;
	include /etc/letsencrypt/options-ssl-nginx.conf;
	ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	include /var/www/ctf/framework/dev/conf/rewrite/bot.cfg;
	include /var/www/ctf/framework/dev/conf/rewrite/asset.cfg;

	location @minify {
		rewrite ^(.*)$ /_lime?$args&limeEnv=prod&limeApp=comptetaferme&limeName=$1? last;
	}

	location / {
		rewrite ^/user/(.*)$ /_lime?$args&limeEnv=prod&limeApp=comptetaferme&limeName=/user/$1? last;
		rewrite ^(.*)$ /_lime?$args&origin=internal&limeEnv=prod&limeApp=comptetaferme&limeName=/shop/public$1? last;
	}

	include /var/www/ctf/framework/dev/conf/rewrite/lime.cfg;

}

server {

	listen 80;
	server_name boutique.comptetaferme.fr shop.comptetaferme.fr;

	return 301 https://boutique.comptetaferme.fr$request_uri;

}

server {

	listen 443 ssl;
	server_name shop.comptetaferme.fr;

	ssl_certificate /etc/letsencrypt/live/shop.comptetaferme.fr/fullchain.pem;
	ssl_certificate_key /etc/letsencrypt/live/shop.comptetaferme.fr/privkey.pem;
	include /etc/letsencrypt/options-ssl-nginx.conf;
	ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

	return 301 https://boutique.comptetaferme.fr$request_uri;

}